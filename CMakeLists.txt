cmake_minimum_required(VERSION 3.25)

project(BlockBreakC LANGUAGES C VERSION 1.2)

option(BUILD_IMPL_SDL3 "Build ${PROJECT_NAME} using SDL3" off)
option(BUILD_IMPL_FREEGLUT "Build ${PROJECT_NAME} using FreeGLUT" on)
option(BUILD_FOR_OLDWIN "Build ${PROJECT_NAME} using msvcrt20 (Mingw-w64 Required)" off)

set(CMAKE_C_FLAGS_DEBUG "-g -Wall")
set(CMAKE_C_FLAGS_RELEASE "-s -O2")

if (WIN32)
	set(CMAKE_C_FLAGS "-Wl,-subsystem,windows")
	if(BUILD_FOR_OLDWIN)
		set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -mcrtdll=msvcrt20 -march=i586")
	endif()
endif()

if(BUILD_IMPL_SDL3)
	if(BUILD_FOR_OLDWIN)
		message(WARNING "SDL3 Requires Windows XP or higher")
	endif()
	find_package(SDL3 REQUIRED)
	include_directories(${SDL3_INCLUDE_DIRS})
	set(IMPL_FILES "src/impl/sdl3.c")
elseif(BUILD_IMPL_FREEGLUT)
	find_package(OpenGL REQUIRED)
	find_package(GLUT REQUIRED)
	include_directories(${OPENGL_INCLUDE_DIRS})
	set(IMPL_FILES "src/impl/freeGLUT.c")
else()
	message(FATAL_ERROR "You must spectify what implementation (SDL3 or FreeGLUT) you want to compile")
endif()

file(GLOB SOURCE_FILES "src/*.c" ${IMPL_FILES})

configure_file(src/progInfo.h.in ${CMAKE_CURRENT_SOURCE_DIR}/src/progInfo.h @ONLY)

add_executable(${PROJECT_NAME} ${SOURCE_FILES})
if(BUILD_IMPL_SDL3)
	target_link_libraries(${PROJECT_NAME} SDL3)
elseif(BUILD_IMPL_FREEGLUT)
	target_link_libraries(${PROJECT_NAME} ${OPENGL_LIBRARY})
	if(BUILD_FOR_OLDWIN)
		target_link_libraries(${PROJECT_NAME} freeglut.a)
	else()
		target_link_libraries(${PROJECT_NAME} ${GLUT_glut_LIBRARY})
	endif()
endif()
target_include_directories(${PROJECT_NAME} PRIVATE src)